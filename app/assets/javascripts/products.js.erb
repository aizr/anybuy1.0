// Place all the behaviors and hooks related to the matching controller here.
// All this logic will automatically be available in application.js.
// You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

$(function(){
	$('.carousel').carousel( {
		interval: 5000
	});
	setInterval(function(){countdown()}, 1000);
});

function countdown(){
	$('.countthis').each(function(){
		var time = parseInt($(this).attr('time'), 10);
		var now = new Date();
		now_secs = Math.round(now.getTime()/1000);
		if(now_secs >= time){
			$(this).html('0d 00:00:00');
			$(this).removeClass('countthis');
			$(this).addClass('countover');
			$('.bidsubmit', $('.thumbnail').has(this)).attr('disabled', 'disabled');
		}
		else{
			var remain_secs = (time - now_secs);
			var days = Math.floor(remain_secs / 86400);
			remain_secs = remain_secs % 86400;

			var hours = Math.floor(remain_secs / 3600);
			if(hours.toString().length < 2){
				hours = '0' + hours.toString();
			}
			remain_secs = remain_secs % 3600;

			var mins = Math.floor(remain_secs / 60);
			if(mins.toString().length < 2){
				mins = '0' + mins.toString();
			}
			remain_secs = remain_secs % 60;

			var count_str = days + 'd ' + hours + ':' + mins + ':' + remain_secs;
			$(this).html(count_str);
			$('.bidsubmit', $('.thumbnail').has(this)).removeAttr('disabled');
		}
	});
}
